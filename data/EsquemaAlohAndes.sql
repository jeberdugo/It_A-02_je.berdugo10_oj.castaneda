--- Sentencias SQL para la creacion del esquema de AlohAndes

-- USO
-- Copie el contenido de este archivo en una pesta SQL de SQL Developer
-- Ejecutelo como un script - Utilice el boton correspondiente de la pesta utilizada

-- Creacion del secuenciador
create sequence alohandes_sequence;

-- Creacion de la tabla USUARIO
CREATE TABLE USUARIO
    (   ID NUMBER, 
        USUARIO VARCHAR2(255 BYTE), 
        CORREO VARCHAR2(255 BYTE),
        CONTRASENA VARCHAR2(255 BYTE),
        NUMERO_DOCUMENTO NUMBER,
        TIPO_DOCUMENTO NUMBER);
    
-- Creacion de la tabla OPERADOR
CREATE TABLE OPERADOR 
    (   ID NUMBER, 
        TIPO NUMBER);
  
-- Creacion de la tabla CLIENTE
CREATE TABLE CLIENTE
    (   ID NUMBER,  
        NOMBRE VARCHAR2(255 BYTE), 
        ROL NUMBER);  
    
-- Creacion de la tabla OFERTA
CREATE TABLE OFERTA
    (   ID NUMBER,
        DIA DATE,
        PRECIO NUMBER,
        ALOJAMIENTO_ID NUMBER,
        RESERVA_ID NUMBER);
    
-- Creacion de la tabla RESERVA
CREATE TABLE RESERVA
    (   ID NUMBER, 
        ESTADO VARCHAR2(255 BYTE), 
        VALOR_TOTAL NUMBER,
        CLIENTE_ID NUMBER);
        
-- Creacion de la tabla ALOJAMIENTO
CREATE TABLE ALOJAMIENTO 
    (   ID NUMBER,
        UBICACION VARCHAR2(255 BYTE), 
        CAPACIDAD NUMBER,
        DESCRIPCION VARCHAR2(255 BYTE),
        TIPO NUMBER,
        REGISTRO_CAM VARCHAR2(255 BYTE),
        REGISTRO_SUP VARCHAR2(255 BYTE),
        OPERADOR_ID NUMBER);
    
-- Creacion de la tabla HORARIO
CREATE TABLE HORARIO 
    (   ID NUMBER,
        HORA_INICIO DATE, 
        HORA_FIN DATE,
        DIAS_SEMANA VARCHAR2(255 BYTE));
        
-- Creacion de la tabla REGLA
CREATE TABLE REGLA 
    (   ID NUMBER,
        DESCRIPCION VARCHAR2(255 BYTE), 
        ALOJAMIENTO_ID NUMBER);
        
-- Creacion de la tabla MENAJE
CREATE TABLE MENAJE 
    (   ID NUMBER,
        DESCRIPCION VARCHAR2(255 BYTE), 
        DISPONIBILIDAD NUMBER,
        ALOJAMIENTO_ID NUMBER);
        
-- Creacion de la tabla SEGURO
CREATE TABLE SEGURO 
    (   ID NUMBER,
        CARACTERISTICAS VARCHAR2(255 BYTE), 
        COSTO NUMBER,
        VIGENCIA DATE,
        ALOJAMIENTO_ID NUMBER);
        
-- Creacion de la tabla SERVICIOS_ALOJAMIENTOS
CREATE TABLE SERVICIOS_ALOJAMIENTOS 
    (   ALOJAMIENTO_ID NUMBER,
        SERVICIO_ID NUMBER);
        
-- Creacion de la tabla SERVICIO
CREATE TABLE SERVICIO 
    (   ID NUMBER,
        DESCRIPCION VARCHAR2(255 BYTE), 
        COSTO NUMBER,
        HORARIO_ID NUMBER);
        
-- Creacion de la tabla HABITACION
CREATE TABLE HABITACION  
    (   ID NUMBER,
        CAPACIDAD NUMBER, 
        TIPO NUMBER,
        ALOJAMIENTO_ID NUMBER);
    
-- Asignacion de llaves primarias
ALTER TABLE USUARIO ADD PRIMARY KEY (ID);
ALTER TABLE OPERADOR ADD PRIMARY KEY (ID);
ALTER TABLE CLIENTE ADD PRIMARY KEY (ID);
ALTER TABLE OFERTA ADD PRIMARY KEY (ID);
ALTER TABLE RESERVA ADD PRIMARY KEY (ID);
ALTER TABLE ALOJAMIENTO ADD PRIMARY KEY (ID);
ALTER TABLE HORARIO ADD PRIMARY KEY (ID);
ALTER TABLE REGLA ADD PRIMARY KEY (ID);
ALTER TABLE MENAJE ADD PRIMARY KEY (ID);
ALTER TABLE SEGURO ADD PRIMARY KEY (ID);
ALTER TABLE SERVICIOS_ALOJAMIENTOS ADD PRIMARY KEY (ALOJAMIENTO_ID, SERVICIO_ID);
ALTER TABLE SERVICIO ADD PRIMARY KEY (ID);
ALTER TABLE HABITACION ADD PRIMARY KEY (ID);

-- Restricciones de la tabla USUARIO    
ALTER TABLE USUARIO MODIFY USUARIO NOT NULL;
ALTER TABLE USUARIO MODIFY CORREO NOT NULL;
ALTER TABLE USUARIO MODIFY CONTRASENA NOT NULL;
ALTER TABLE USUARIO MODIFY NUMERO_DOCUMENTO NOT NULL;
ALTER TABLE USUARIO MODIFY TIPO_DOCUMENTO NOT NULL;

ALTER TABLE USUARIO ADD CONSTRAINT UN_USUARIO_USUARIO UNIQUE (USUARIO);
ALTER TABLE USUARIO ADD CONSTRAINT UN_USUARIO_CORREO UNIQUE (CORREO);
ALTER TABLE USUARIO ADD CONSTRAINT UN_USUARIO_NUMERO_DOCUMENTO UNIQUE (NUMERO_DOCUMENTO);

ALTER TABLE USUARIO ADD CONSTRAINT CK_USUARIO_TIPO_DOCUMENTO CHECK (TIPO_DOCUMENTO >-1 AND TIPO_DOCUMENTO <3);
ALTER TABLE USUARIO ADD CONSTRAINT CK_USUARIO_NUMERO_DOCUMENTO CHECK (NUMERO_DOCUMENTO >-1);

-- Restricciones de la tabla OPERADOR 
ALTER TABLE OPERADOR ADD CONSTRAINT FK_OPERADOR_USUARIO_ID FOREIGN KEY (ID) REFERENCES USUARIO(ID);

ALTER TABLE OPERADOR MODIFY TIPO NOT NULL;

ALTER TABLE OPERADOR ADD CONSTRAINT CK_OPERADOR_TIPO CHECK (TIPO >-1 AND TIPO <2);

-- Restricciones de la tabla CLIENTE 
ALTER TABLE CLIENTE ADD CONSTRAINT FK_CLIENTE_IDUSUARIO FOREIGN KEY (ID) REFERENCES USUARIO(ID);

ALTER TABLE CLIENTE MODIFY NOMBRE NOT NULL;
ALTER TABLE CLIENTE MODIFY ROL NOT NULL;

ALTER TABLE CLIENTE ADD CONSTRAINT CK_CLIENTE_ROL CHECK (ROL >-1 AND ROL<5);

-- Restricciones de la tabla OFERTA 
ALTER TABLE OFERTA ADD CONSTRAINT FK_OFERTA_ALOJAMIENTO_ID FOREIGN KEY (ALOJAMIENTO_ID) REFERENCES ALOJAMIENTO(ID);
ALTER TABLE OFERTA ADD CONSTRAINT FK_OFERTA_RESERVA_ID FOREIGN KEY (RESERVA_ID) REFERENCES RESERVA(ID);

ALTER TABLE OFERTA MODIFY DIA NOT NULL;
ALTER TABLE OFERTA MODIFY PRECIO NOT NULL;
ALTER TABLE OFERTA MODIFY ALOJAMIENTO_ID NOT NULL;  

ALTER TABLE OFERTA ADD CONSTRAINT CK_OFERTA_PRECIO CHECK (PRECIO >-1);

-- Restricciones de la tabla RESERVA 
ALTER TABLE RESERVA ADD CONSTRAINT FK_RESERVA_CLIENTE_ID FOREIGN KEY (CLIENTE_ID) REFERENCES CLIENTE(ID);

ALTER TABLE RESERVA MODIFY ESTADO NOT NULL;
ALTER TABLE RESERVA MODIFY VALOR_TOTAL NOT NULL;

ALTER TABLE RESERVA ADD CONSTRAINT CK_RESERVA_ESTADO CHECK (ESTADO >-1 AND ESTADO<2);
ALTER TABLE RESERVA ADD CONSTRAINT CK_RESERVA_VALOR_TOTAL CHECK (VALOR_TOTAL >-1);

-- Restricciones de la tabla ALOJAMIENTO 
ALTER TABLE ALOJAMIENTO ADD CONSTRAINT FK_ALOJAMIENTO_OPERADOR_ID FOREIGN KEY (OPERADOR_ID) REFERENCES OPERADOR(ID);

ALTER TABLE ALOJAMIENTO MODIFY UBICACION NOT NULL;
ALTER TABLE ALOJAMIENTO MODIFY CAPACIDAD NOT NULL;
ALTER TABLE ALOJAMIENTO MODIFY DESCRIPCION NOT NULL;
ALTER TABLE ALOJAMIENTO MODIFY TIPO NOT NULL;
ALTER TABLE ALOJAMIENTO MODIFY OPERADOR_ID NOT NULL;

ALTER TABLE ALOJAMIENTO ADD CONSTRAINT CK_ALOJAMIENTO_CAPACIDAD CHECK (CAPACIDAD >-1);
ALTER TABLE ALOJAMIENTO ADD CONSTRAINT CK_ALOJAMIENTO_TIPO CHECK (TIPO >-1 AND TIPO<6);

-- Restricciones de la tabla HORARIO 
ALTER TABLE HORARIO MODIFY HORA_INICIO NOT NULL;
ALTER TABLE HORARIO MODIFY HORA_FIN NOT NULL;
ALTER TABLE HORARIO MODIFY DIAS_SEMANA NOT NULL;

ALTER TABLE HORARIO ADD CONSTRAINT CK_HORARIO_HORA_FIN CHECK (HORA_FIN >HORA_INICIO);

-- Restricciones de la tabla REGLA 
ALTER TABLE REGLA ADD CONSTRAINT FK_REGLA_ALOJAMIENTO_ID FOREIGN KEY (ALOJAMIENTO_ID) REFERENCES ALOJAMIENTO(ID);

ALTER TABLE REGLA MODIFY DESCRIPCION NOT NULL;
ALTER TABLE REGLA MODIFY ALOJAMIENTO_ID NOT NULL;  

-- Restricciones de la tabla MENAJE 
ALTER TABLE MENAJE ADD CONSTRAINT FK_MENAJE_ALOJAMIENTO_ID FOREIGN KEY (ALOJAMIENTO_ID) REFERENCES ALOJAMIENTO(ID);

ALTER TABLE MENAJE MODIFY DESCRIPCION NOT NULL;
ALTER TABLE MENAJE MODIFY DISPONIBILIDAD NOT NULL;
ALTER TABLE MENAJE MODIFY ALOJAMIENTO_ID NOT NULL;

ALTER TABLE MENAJE ADD CONSTRAINT CK_MENAJE_DISPONIBILIDAD CHECK (DISPONIBILIDAD >-1 AND DISPONIBILIDAD<2);

-- Restricciones de la tabla SEGURO 
ALTER TABLE SEGURO ADD CONSTRAINT FK_SEGURO_ALOJAMIENTO_ID FOREIGN KEY (ALOJAMIENTO_ID) REFERENCES ALOJAMIENTO(ID);

ALTER TABLE SEGURO MODIFY CARACTERISTICAS NOT NULL;
ALTER TABLE SEGURO MODIFY COSTO NOT NULL;
ALTER TABLE SEGURO MODIFY VIGENCIA NOT NULL;
ALTER TABLE SEGURO MODIFY ALOJAMIENTO_ID NOT NULL;

ALTER TABLE SEGURO ADD CONSTRAINT CK_SEGURO_COSTO CHECK (COSTO >-1);

-- Restricciones de la tabla SERVICIOS_ALOJAMIENTOS 
ALTER TABLE SERVICIOS_ALOJAMIENTOS ADD CONSTRAINT FK_S_A_ALOJAMIENTO_ID FOREIGN KEY (ALOJAMIENTO_ID) REFERENCES ALOJAMIENTO(ID);
ALTER TABLE SERVICIOS_ALOJAMIENTOS ADD CONSTRAINT FK_S_A_SERVICIO_ID FOREIGN KEY (SERVICIO_ID) REFERENCES SERVICIO(ID);

ALTER TABLE SERVICIOS_ALOJAMIENTOS MODIFY ALOJAMIENTO_ID NOT NULL;
ALTER TABLE SERVICIOS_ALOJAMIENTOS MODIFY SERVICIO_ID NOT NULL;

-- Restricciones de la tabla SERVICIO 
ALTER TABLE SERVICIO ADD CONSTRAINT FK_SERVICIO_HORARIO_ID FOREIGN KEY (HORARIO_ID) REFERENCES HORARIO(ID);

ALTER TABLE SERVICIO MODIFY DESCRIPCION NOT NULL;
ALTER TABLE SERVICIO MODIFY COSTO NOT NULL;
ALTER TABLE SERVICIO MODIFY HORARIO_ID NOT NULL;

ALTER TABLE SERVICIO ADD CONSTRAINT CK_SERVICIO_COSTO CHECK (COSTO >-1);

-- Restricciones de la tabla HABITACION 
ALTER TABLE HABITACION ADD CONSTRAINT FK_HABITACION_ALOJAMIENTO_ID FOREIGN KEY (ALOJAMIENTO_ID) REFERENCES ALOJAMIENTO(ID);

ALTER TABLE HABITACION MODIFY CAPACIDAD NOT NULL;
ALTER TABLE HABITACION MODIFY TIPO NOT NULL;
ALTER TABLE HABITACION MODIFY ALOJAMIENTO_ID NOT NULL;

ALTER TABLE HABITACION ADD CONSTRAINT CK_HABITACION_CAPACIDAD CHECK (CAPACIDAD >-1);
ALTER TABLE HABITACION ADD CONSTRAINT CK_HABITACION_TIPO CHECK (TIPO >-1 AND TIPO<4);

COMMIT;
